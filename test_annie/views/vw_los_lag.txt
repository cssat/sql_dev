CREATE ALGORITHM=UNDEFINED DEFINER=`test_annie`@`localhost` SQL SECURITY DEFINER VIEW `vw_los_lag` AS select `los`.`bin_los_cd` AS `bin_los_cd`,`los`.`bin_los_desc` AS `bin_los_desc`,`los`.`dur_days_from` AS `dur_days_from`,`los`.`dur_days_thru` AS `dur_days_thru`,`los`.`lag` AS `lag`,1 AS `date_type`,(case when (`los`.`bin_los_cd` = 0) then `dw`.`cutoff_date` else ((`dw`.`cutoff_date` + interval (-(1) * abs(`los`.`lag`)) day) + interval -(3) month) end) AS `max_filter_date`,(case when (`los`.`bin_los_cd` = 0) then `dw`.`cutoff_date` else ((`dw`.`cutoff_date` + interval (-(1) * abs(`los`.`lag`)) day) + interval -(12) month) end) AS `cohort_max_filter_date` from (`ref_filter_los` `los` join `ref_last_dw_transfer` `dw`) union select `los`.`bin_los_cd` AS `bin_los_cd`,`los`.`bin_los_desc` AS `bin_los_desc`,`los`.`dur_days_from` AS `dur_days_from`,`los`.`dur_days_thru` AS `dur_days_thru`,`los`.`lag` AS `lag`,2 AS `date_type`,(case when (`los`.`bin_los_cd` = 0) then `dw`.`cutoff_date` else ((`dw`.`cutoff_date` + interval (-(1) * abs(`los`.`lag`)) day) + interval -(12) month) end) AS `max_filter_date`,(case when (`los`.`bin_los_cd` = 0) then `dw`.`cutoff_date` else ((`dw`.`cutoff_date` + interval (-(1) * abs(`los`.`lag`)) day) + interval -(21) month) end) AS `cohort_max_filter_date` from (`ref_filter_los` `los` join `ref_last_dw_transfer` `dw`)